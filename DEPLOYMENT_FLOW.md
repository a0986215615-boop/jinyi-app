# 🎯 部署流程圖

```
┌─────────────────────────────────────────────────────────────┐
│                     部署流程總覽                              │
└─────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────┐
    │  📝 步驟 1: 本地開發環境                 │
    │  ─────────────────────────────────      │
    │  • 安裝依賴 (npm install)                │
    │  • 配置 .env.local                       │
    │  • 本地測試 (npm run dev)                │
    └─────────────────┬───────────────────────┘
                      │
                      ▼
    ┌─────────────────────────────────────────┐
    │  🗄️ 步驟 2: Supabase 設置               │
    │  ─────────────────────────────────      │
    │  • 創建 Supabase 項目                    │
    │  • 執行 supabase-init.sql                │
    │  • 複製 API 憑證                         │
    │  • 配置 RLS 策略                         │
    └─────────────────┬───────────────────────┘
                      │
                      ▼
    ┌─────────────────────────────────────────┐
    │  🔧 步驟 3: 環境變量配置                 │
    │  ─────────────────────────────────      │
    │  • VITE_SUPABASE_URL                     │
    │  • VITE_SUPABASE_ANON_KEY                │
    │  • GEMINI_API_KEY                        │
    └─────────────────┬───────────────────────┘
                      │
                      ▼
    ┌─────────────────────────────────────────┐
    │  🐙 步驟 4: Git & GitHub                │
    │  ─────────────────────────────────      │
    │  • git init                              │
    │  • git add .                             │
    │  • git commit                            │
    │  • 創建 GitHub 倉庫                      │
    │  • git push                              │
    └─────────────────┬───────────────────────┘
                      │
                      ▼
    ┌─────────────────────────────────────────┐
    │  ☁️ 步驟 5: Cloudflare Pages 部署       │
    │  ─────────────────────────────────      │
    │  • 連接 GitHub 倉庫                      │
    │  • 配置構建設置                          │
    │    - Framework: Vite                     │
    │    - Build: npm run build                │
    │    - Output: dist                        │
    │  • 添加環境變量                          │
    │  • 觸發部署                              │
    └─────────────────┬───────────────────────┘
                      │
                      ▼
    ┌─────────────────────────────────────────┐
    │  🌐 步驟 6: 域名配置                     │
    │  ─────────────────────────────────      │
    │  • 添加自定義域名: jinyi.us.kg           │
    │  • Cloudflare 自動配置 DNS               │
    │  • 等待 DNS 傳播                         │
    │  • 啟用 HTTPS                            │
    └─────────────────┬───────────────────────┘
                      │
                      ▼
    ┌─────────────────────────────────────────┐
    │  ✅ 步驟 7: 驗證部署                     │
    │  ─────────────────────────────────      │
    │  • 訪問 https://jinyi.us.kg              │
    │  • 測試應用功能                          │
    │  • 檢查數據同步                          │
    │  • 驗證跨設備訪問                        │
    └─────────────────┬───────────────────────┘
                      │
                      ▼
    ┌─────────────────────────────────────────┐
    │  🎉 部署完成！                           │
    │  ─────────────────────────────────      │
    │  你的應用現在可以在全球訪問了！           │
    └─────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────┐
│                     關鍵組件關係圖                            │
└─────────────────────────────────────────────────────────────┘

    用戶設備 1                    用戶設備 2
        │                            │
        │                            │
        ▼                            ▼
    ┌──────────────────────────────────────┐
    │      https://jinyi-app.pages.dev/#/book             │
    │      (Cloudflare Pages)              │
    │  ┌────────────────────────────────┐  │
    │  │   React App (Vite Build)       │  │
    │  │   • App.tsx                    │  │
    │  │   • Components                 │  │
    │  │   • Services                   │  │
    │  └────────────────────────────────┘  │
    └──────────┬───────────────┬───────────┘
               │               │
               │               │
      ┌────────┘               └────────┐
      │                                 │
      ▼                                 ▼
┌──────────────┐              ┌──────────────┐
│ Gemini API   │              │  Supabase    │
│              │              │              │
│ • AI 對話    │              │ •  數據存儲  │
│ • 內容生成   │              │ • 實時同步   │
│              │              │ • 用戶認證   │
└──────────────┘              └──────────────┘


┌─────────────────────────────────────────────────────────────┐
│                     數據流向圖                                │
└─────────────────────────────────────────────────────────────┘

用戶操作
   │
   ▼
React App (前端)
   │
   ├─────────────────┐
   │                 │
   ▼                 ▼
Gemini Service   Supabase Service
   │                 │
   ▼                 ▼
Google AI API    Supabase API
   │                 │
   ▼                 ▼
AI 響應          PostgreSQL 數據庫
   │                 │
   └────────┬────────┘
            │
            ▼
        返回給用戶
            │
            ▼
    跨設備實時同步


┌─────────────────────────────────────────────────────────────┐
│                     環境變量配置                              │
└─────────────────────────────────────────────────────────────┘

本地開發 (.env.local)          生產環境 (Cloudflare)
        │                              │
        ├─ GEMINI_API_KEY ─────────────┤
        ├─ VITE_SUPABASE_URL ──────────┤
        └─ VITE_SUPABASE_ANON_KEY ─────┘

注意: 
• .env.local 不要提交到 Git
• Cloudflare 環境變量在 Pages 設置中配置
• 兩個環境使用相同的 Supabase 項目


┌─────────────────────────────────────────────────────────────┐
│                     部署時間估算                              │
└─────────────────────────────────────────────────────────────┘

任務                          預計時間
────────────────────────────────────────
Supabase 項目創建              2-3 分鐘
數據庫初始化                   1 分鐘
本地環境配置                   5 分鐘
Git 設置和推送                 3-5 分鐘
Cloudflare Pages 部署          2-3 分鐘
DNS 配置和傳播                 1-5 分鐘
測試和驗證                     5 分鐘
────────────────────────────────────────
總計                          約 20-30 分鐘


┌─────────────────────────────────────────────────────────────┐
│                     故障排除決策樹                            │
└─────────────────────────────────────────────────────────────┘

部署失敗？
   │
   ├─ 構建失敗？
   │    ├─ 檢查 package.json
   │    ├─ 檢查環境變量
   │    └─ 查看構建日誌
   │
   ├─ Supabase 連接失敗？
   │    ├─ 檢查 URL 格式
   │    ├─ 檢查 API Key
   │    └─ 檢查 RLS 策略
   │
   ├─ 域名無法訪問？
   │    ├─ 檢查 DNS 設置
   │    ├─ 等待 DNS 傳播
   │    └─ 清除瀏覽器緩存
   │
   └─ 其他問題？
        └─ 查看 DEPLOYMENT.md


┌─────────────────────────────────────────────────────────────┐
│                     後續優化建議                              │
└─────────────────────────────────────────────────────────────┘

1. 安全性
   • 配置嚴格的 RLS 策略
   • 啟用 Supabase Auth
   • 定期更新依賴

2. 性能
   • 啟用 Cloudflare CDN
   • 優化圖片加載
   • 實現代碼分割

3. 監控
   • 設置 Cloudflare Analytics
   • 配置錯誤追蹤
   • 監控 API 使用量

4. 用戶體驗
   • 添加 PWA 支持
   • 實現離線功能
   • 優化移動端體驗

<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase é€£æ¥æ¸¬è©¦</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 28px;
            text-align: center;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        input,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .data-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #1976d2;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ—„ï¸ Supabase è³‡æ–™åº«æ¸¬è©¦</h1>

        <div id="statusDiv" class="status loading">
            æ­£åœ¨åˆå§‹åŒ–é€£æ¥...
        </div>

        <div class="info-box">
            <strong>æç¤ºï¼š</strong> æ­¤é é¢ç”¨æ–¼æ¸¬è©¦ Supabase è³‡æ–™åº«é€£æ¥å’Œè³‡æ–™å›å‚³åŠŸèƒ½
        </div>

        <div class="input-group">
            <label for="userIdInput">ç”¨æˆ¶ IDï¼š</label>
            <input type="text" id="userIdInput" placeholder="è¼¸å…¥ç”¨æˆ¶ IDï¼ˆä¾‹å¦‚ï¼štest-user-123ï¼‰" value="test-user-123">
        </div>

        <div class="input-group">
            <label for="dataInput">æ¸¬è©¦è³‡æ–™ï¼ˆJSON æ ¼å¼ï¼‰ï¼š</label>
            <textarea id="dataInput" placeholder='{"message": "Hello World", "timestamp": "2024-01-01"}'>{
  "message": "Hello from Supabase!",
  "timestamp": "2024-01-01",
  "count": 1
}</textarea>
        </div>

        <div class="button-group">
            <button class="btn-success" onclick="saveData()">ğŸ’¾ å„²å­˜è³‡æ–™</button>
            <button class="btn-info" onclick="loadData()">ğŸ“¥ è¼‰å…¥è³‡æ–™</button>
            <button class="btn-danger" onclick="deleteData()">ğŸ—‘ï¸ åˆªé™¤è³‡æ–™</button>
            <button class="btn-primary" onclick="testConnection()">ğŸ” æ¸¬è©¦é€£æ¥</button>
        </div>

        <div id="dataDisplay" class="data-display" style="display: none;"></div>
    </div>

    <script>
        let supabase = null;

        // åˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯
        function initSupabase() {
            // Supabase æ†‘è­‰å·²è‡ªå‹•é…ç½®
            const SUPABASE_URL = 'https://zntvofpaohnouepquxke.supabase.co';
            const SUPABASE_ANON_KEY = 'sb_publishable_TZOgnWwcDA1bRfHghcRSyg_lbmnh4jb';

            if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
                showStatus('è«‹å…ˆé…ç½® Supabase æ†‘è­‰ï¼è«‹ç·¨è¼¯ HTML æ–‡ä»¶ä¸­çš„ SUPABASE_URL å’Œ SUPABASE_ANON_KEY', 'error');
                return false;
            }

            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                showStatus('Supabase å®¢æˆ¶ç«¯å·²åˆå§‹åŒ–', 'success');
                return true;
            } catch (error) {
                showStatus('åˆå§‹åŒ–å¤±æ•—: ' + error.message, 'error');
                return false;
            }
        }

        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('statusDiv');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        function showData(data) {
            const dataDisplay = document.getElementById('dataDisplay');
            dataDisplay.style.display = 'block';
            dataDisplay.textContent = JSON.stringify(data, null, 2);
        }

        async function testConnection() {
            if (!supabase) {
                showStatus('è«‹å…ˆåˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯', 'error');
                return;
            }

            showStatus('æ­£åœ¨æ¸¬è©¦é€£æ¥...', 'loading');

            try {
                const { data, error } = await supabase
                    .from('user_data')
                    .select('count');

                if (error) throw error;

                showStatus('âœ… é€£æ¥æˆåŠŸï¼è³‡æ–™è¡¨å¯è¨ªå•', 'success');
                showData({
                    status: 'connected',
                    message: 'è³‡æ–™åº«é€£æ¥æ­£å¸¸',
                    rowCount: data ? data.length : 0
                });
            } catch (error) {
                showStatus('âŒ é€£æ¥å¤±æ•—: ' + error.message, 'error');
                showData({ error: error.message, details: error });
            }
        }

        async function saveData() {
            if (!supabase) {
                showStatus('è«‹å…ˆåˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯', 'error');
                return;
            }

            const userId = document.getElementById('userIdInput').value;
            const dataInput = document.getElementById('dataInput').value;

            if (!userId) {
                showStatus('è«‹è¼¸å…¥ç”¨æˆ¶ ID', 'error');
                return;
            }

            try {
                const jsonData = JSON.parse(dataInput);
                showStatus('æ­£åœ¨å„²å­˜è³‡æ–™...', 'loading');

                const { data, error } = await supabase
                    .from('user_data')
                    .upsert({
                        user_id: userId,
                        data: jsonData,
                        updated_at: new Date().toISOString(),
                    }, {
                        onConflict: 'user_id'
                    })
                    .select();

                if (error) throw error;

                showStatus('âœ… è³‡æ–™å„²å­˜æˆåŠŸï¼', 'success');
                showData({
                    action: 'save',
                    userId: userId,
                    savedData: jsonData,
                    result: data
                });
            } catch (error) {
                showStatus('âŒ å„²å­˜å¤±æ•—: ' + error.message, 'error');
                showData({ error: error.message, details: error });
            }
        }

        async function loadData() {
            if (!supabase) {
                showStatus('è«‹å…ˆåˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯', 'error');
                return;
            }

            const userId = document.getElementById('userIdInput').value;

            if (!userId) {
                showStatus('è«‹è¼¸å…¥ç”¨æˆ¶ ID', 'error');
                return;
            }

            showStatus('æ­£åœ¨è¼‰å…¥è³‡æ–™...', 'loading');

            try {
                const { data, error } = await supabase
                    .from('user_data')
                    .select('data, updated_at')
                    .eq('user_id', userId)
                    .single();

                if (error) {
                    if (error.code === 'PGRST116') {
                        showStatus('âš ï¸ æ‰¾ä¸åˆ°è©²ç”¨æˆ¶çš„è³‡æ–™', 'error');
                        showData({ message: 'æ²’æœ‰æ‰¾åˆ°è³‡æ–™', userId: userId });
                        return;
                    }
                    throw error;
                }

                showStatus('âœ… è³‡æ–™è¼‰å…¥æˆåŠŸï¼', 'success');
                showData({
                    action: 'load',
                    userId: userId,
                    loadedData: data.data,
                    updatedAt: data.updated_at
                });

                // æ›´æ–°è¼¸å…¥æ¡†
                document.getElementById('dataInput').value = JSON.stringify(data.data, null, 2);
            } catch (error) {
                showStatus('âŒ è¼‰å…¥å¤±æ•—: ' + error.message, 'error');
                showData({ error: error.message, details: error });
            }
        }

        async function deleteData() {
            if (!supabase) {
                showStatus('è«‹å…ˆåˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯', 'error');
                return;
            }

            const userId = document.getElementById('userIdInput').value;

            if (!userId) {
                showStatus('è«‹è¼¸å…¥ç”¨æˆ¶ ID', 'error');
                return;
            }

            if (!confirm('ç¢ºå®šè¦åˆªé™¤ç”¨æˆ¶ "' + userId + '" çš„è³‡æ–™å—ï¼Ÿ')) {
                return;
            }

            showStatus('æ­£åœ¨åˆªé™¤è³‡æ–™...', 'loading');

            try {
                const { error } = await supabase
                    .from('user_data')
                    .delete()
                    .eq('user_id', userId);

                if (error) throw error;

                showStatus('âœ… è³‡æ–™åˆªé™¤æˆåŠŸï¼', 'success');
                showData({
                    action: 'delete',
                    userId: userId,
                    message: 'è³‡æ–™å·²åˆªé™¤'
                });
            } catch (error) {
                showStatus('âŒ åˆªé™¤å¤±æ•—: ' + error.message, 'error');
                showData({ error: error.message, details: error });
            }
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = function () {
            initSupabase();
        };
    </script>
</body>

</html>